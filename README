# HBAR–DOGE Mean Reversion & Bollinger Bot

[![CI](https://github.com/savvaniss/mean-pair/actions/workflows/ci.yml/badge.svg)](https://github.com/savvaniss/mean-pair/actions/workflows/ci.yml)

A modular cryptocurrency trading bot that implements **mean reversion** for the HBAR/DOGE ratio and **Bollinger Band** strategies for single trading pairs. The backend is built with FastAPI, Python, and SQLite, and the lightweight HTML/JavaScript dashboard lives in `static/`. A full pytest suite and GitHub Actions CI pipeline keep the project validated in development.

---

## Key Functionality

### Mean Reversion Bot (HBAR ↔ DOGE)

- Trades the ratio `HBARUSDC / DOGEUSDC` to capitalize on reversion toward the rolling mean.
- Rolling statistics and signals:
  - Mean, standard deviation, and z-score
  - Entry/exit thresholds (`z_entry` and `z_exit`) with optional fixed ratio thresholds
- Maintains internal portfolio state:
  - Current asset and quantity
  - Realized and unrealized PnL
- Full trade logging plus manual trade support for discretionary entries/exits.
- Works on Binance testnet or mainnet, controlled through environment variables.

### Single-Coin Bollinger Bot

- Trades any supported symbol vs USDC, USDT, or BTC (e.g., `BNBUSDC`, `ETHUSDT`).
- Bollinger Band calculation with moving average, standard deviation, and upper/lower bands.
- Configurable parameters: window size, band width, maximum position size, stop-loss/take-profit, cooldown interval.
- Tracks quote balance, asset quantity, and realized/unrealized PnL.
- Detailed trade history and a manual exit endpoint for risk control.

### Shared Platform Features

- FastAPI service exposing JSON endpoints for both strategies.
- Centralized configuration management in `config.py` with per-bot settings.
- SQLite-backed state and logging handled via `database.py`.
- Single-page dashboard for live monitoring, manual control, and charting.
- Docker and docker-compose for reproducible deployments.

---

## Dashboard

The HTML/JavaScript dashboard (served from `/`) provides:

- Live status for both bots, including balances, prices, and PnL
- Mean-reversion ratio charts and Bollinger price/band charts
- Inline configuration editor for both strategies
- Manual trading controls and quick status toggles
- Trade history tables for auditing decisions

Static assets live in `static/` and are served directly by FastAPI.

---

## Project Structure

```
mean-pair/
├── app.py                   # FastAPI application setup and route registration
├── config.py                # Default configuration and helper utilities
├── database.py              # SQLite helpers and database initialization
├── engines/                 # Trading logic implementations
│   ├── bollinger.py         # Bollinger Band strategy engine
│   ├── common.py            # Shared helpers (pricing, stats, risk controls)
│   └── mean_reversion.py    # HBAR/DOGE mean-reversion engine
├── routes/                  # FastAPI routers
│   ├── bollinger.py         # Bollinger API routes
│   ├── mean_reversion.py    # Mean reversion API routes
│   └── trading.py           # Shared trading endpoints
├── static/                  # Front-end dashboard assets
│   ├── css/
│   ├── js/
│   └── index.html
├── tests/                   # Pytest suite covering logic and APIs
├── .github/workflows/ci.yml # GitHub Actions CI (linting/tests)
├── Dockerfile               # Container build for the FastAPI service
└── docker-compose.yml       # Local stack orchestration
```

---

## Environment Variables

Provided via `.env`:

```
# Mean Reversion bot keys
BINANCE_TESTNET_API_KEY=
BINANCE_TESTNET_API_SECRET=
BINANCE_MAINNET_API_KEY=
BINANCE_MAINNET_API_SECRET=

# Bollinger bot keys (optional)
BINANCE_BOLL_TESTNET_API_KEY=
BINANCE_BOLL_TESTNET_API_SECRET=
BINANCE_BOLL_MAINNET_API_KEY=
BINANCE_BOLL_MAINNET_API_SECRET=

# Environment: "testnet" or "mainnet"
ENV=testnet

# Internal flags (used by CI)
BOT_DISABLE_THREADS=0
DISABLE_BINANCE_CLIENT=0
```

---

## Running Locally

Install dependencies:

```
pip install -r requirements.txt
```

Start the development server:

```
uvicorn app:app --reload
```

Open the dashboard:

```
http://localhost:8000
```

---

## Running with Docker

Build and start the stack:

```
docker-compose up --build -d
```

Services:
- FastAPI app: http://localhost:8000
- Nginx Proxy Manager (if enabled): http://localhost:81

---

## API Endpoints

### Mean Reversion

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/status` | Current MR bot status (prices, ratio, PnL) |
| GET | `/next_signal` | Predict next MR trade action |
| GET | `/config` | Get MR config |
| POST | `/config` | Update MR config |
| POST | `/start` | Start MR bot loop |
| POST | `/stop` | Stop MR bot loop |
| POST | `/manual_trade` | Execute manual HBAR↔DOGE trade (specify `from_asset_qty` or `notional_usd`) |
| GET | `/trades` | List MR trades |

### Bollinger

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/boll_config` | Get Bollinger config |
| POST | `/boll_config` | Update Bollinger config |
| GET | `/boll_status` | Current Bollinger status |
| GET | `/boll_history` | Band/MA/price history |
| GET | `/boll_trades` | List Bollinger trades |
| POST | `/bollinger_manual_sell` | Manual exit trade |
| GET | `/symbols_grouped` | Binance symbols grouped by quote asset |

---

## Testing & CI

Run all tests locally:

```
pytest
```

GitHub Actions builds run on every push and pull request via `.github/workflows/ci.yml`, using the following flags to disable live Binance access:

```
DISABLE_BINANCE_CLIENT=1
BOT_DISABLE_THREADS=1
```

The CI badge at the top of this README reflects the latest build status.

---

## Roadmap

- Split monolithic `app.py` into modules
- Add async DB writer
- Add historical backtester
- Improve Bollinger trend filters
- Add WebSocket price streaming
- Extend charting system in UI

---

## License

MIT License © 2025 Savvaniss
