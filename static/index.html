<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Trading Suite</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
  <link rel="stylesheet" href="/static/css/theme.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module" src="/static/js/main.js"></script>
</head>
<body>
  <div class="top-bar">
    <div class="title-block">
      <h1>Pair Trading Suite</h1>
      <div class="title-sub">Unified mean-reversion and Bollinger toolkit</div>
    </div>
    <div class="control-buttons">
      <button class="btn btn-ghost" id="syncStateBtn">Sync MR balances</button>
      <button class="btn btn-ghost" id="nextTradeBtn">Next MR trade</button>
    </div>
  </div>

  <div class="tab-bar">
    <button class="tab active" data-tab="mean">Mean Reversion (Pairs)</button>
    <button class="tab" data-tab="boll">Single-Coin Bollinger</button>
  </div>

  <div id="tab-mean" class="tab-content active">
    <div class="control-buttons" style="margin-bottom:10px;">
      <button class="btn btn-primary" id="startBotBtn">Start MR bot</button>
      <button class="btn btn-danger" id="stopBotBtn">Stop MR bot</button>
    </div>

    <div class="row">
      <div class="card" data-collapsible>
        <div class="card-header">
          <h2>Live Status</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-body">
          <div id="status" class="status-section">Loading...</div>
        </div>
      </div>

      <div class="card" data-collapsible>
        <div class="card-header">
          <h2>Config</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-body">
          <form id="configForm">
            <div class="form-row">
              <div>
                <label for="pair_select">Trading pair</label>
                <select id="pair_select"></select>
              </div>
              <div>
                <label for="poll_interval_sec">Poll interval (sec)</label>
                <input id="poll_interval_sec" type="number" min="5" step="1" />
              </div>
              <div>
                <label for="window_size">Window size</label>
                <input id="window_size" type="number" min="5" step="1" />
              </div>
              <div>
                <label for="z_entry">z-entry</label>
                <input id="z_entry" type="number" step="0.1" />
              </div>
              <div>
                <label for="z_exit">z-exit</label>
                <input id="z_exit" type="number" step="0.1" />
              </div>
              <div>
                <label for="trade_notional_usd">
                  Trade notional (<span class="quote-label">USDT</span>)
                </label>
                <input id="trade_notional_usd" type="number" step="1" />
              </div>
            </div>

            <div class="form-row">
              <div class="form-checkbox">
                <input type="checkbox" id="use_all_balance" />
                <label for="use_all_balance">Use all available HBAR/DOGE</label>
              </div>
              <div class="form-checkbox">
                <input type="checkbox" id="use_ratio_thresholds" />
                <label for="use_ratio_thresholds">Use fixed ratio thresholds</label>
              </div>
              <div>
                <label for="sell_ratio_threshold">Sell ratio threshold</label>
                <input id="sell_ratio_threshold" type="number" step="0.0001" />
              </div>
              <div>
                <label for="buy_ratio_threshold">Buy ratio threshold</label>
                <input id="buy_ratio_threshold" type="number" step="0.0001" />
              </div>
              <div class="form-checkbox">
                <input type="checkbox" id="use_testnet" />
                <label for="use_testnet">Use Binance testnet</label>
              </div>
            </div>

            <button type="submit" class="btn btn-primary">Save config</button>
          </form>
        </div>
      </div>

      <div class="card" data-collapsible>
        <div class="card-header">
          <h2>Pair Health & History</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-body" id="pairHealth">Loading...</div>
      </div>

      <div class="card" data-collapsible>
        <div class="card-header">
          <h2>Manual Trade</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-body">
          <form id="manualTradeForm">
            <div class="form-row">
              <div>
                <label for="manual_direction">Direction</label>
                <select id="manual_direction">
                  <option value="HBAR->DOGE">HBAR → DOGE</option>
                  <option value="DOGE->HBAR">DOGE → HBAR</option>
                </select>
              </div>
              <div>
                <label for="manual_notional">
                  Notional (<span class="quote-label">USDT</span>)
                </label>
                <input id="manual_notional" type="number" value="20" step="1" />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Execute manual trade</button>
          </form>
          <div class="help-text">
            Uses market orders on your current environment (testnet / mainnet).
            Start with small amounts to test.
          </div>
        </div>
      </div>
    </div>

    <div class="card" data-collapsible>
      <div class="card-header">
        <h2>Charts</h2>
        <span class="toggle-icon">▼</span>
      </div>
      <div class="card-body">
        <div class="chart-row">
          <div class="chart-col">
            <h3>HBAR / DOGE Prices</h3>
            <canvas id="priceChart" height="160"></canvas>
          </div>
          <div class="chart-col">
            <h3>Ratio & Bands</h3>
            <canvas id="ratioChart" height="160"></canvas>
            <p id="bandInfo"></p>
          </div>
        </div>
      </div>
    </div>

    <div class="card" data-collapsible>
      <div class="card-header">
        <h2>Recent Trades (latest 100)</h2>
        <span class="toggle-icon">▼</span>
      </div>
      <div class="card-body">
        <table id="tradesTable">
          <thead>
            <tr>
              <th>Time</th>
              <th>Side</th>
              <th>From</th>
              <th>To</th>
              <th>Qty from</th>
              <th>Qty to</th>
              <th>Price</th>
              <th>PnL (<span class="quote-label">USDT</span>)</th>
              <th>Env</th>
            </tr>
          </thead>
          <tbody id="tradesBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="tab-boll" class="tab-content">
    <div class="control-buttons" style="margin-bottom:10px;">
      <button class="btn btn-primary" id="startBollBtn">Start Bollinger bot</button>
      <button class="btn btn-danger" id="stopBollBtn">Stop Bollinger bot</button>
    </div>

    <div class="card" data-collapsible>
      <div class="card-header">
        <h2>Bollinger Config</h2>
        <span class="toggle-icon">▼</span>
      </div>
      <div class="card-body">
        <form id="bollConfigForm">
          <div class="form-row">
            <div>
              <label for="boll_symbol">Symbol</label>
              <select id="boll_symbol"></select>
            </div>
            <div>
              <label for="boll_trade_notional">Trade notional (<span class="quote-label">USDT</span>)</label>
              <input id="boll_trade_notional" type="number" step="1" />
            </div>
            <div>
              <label for="boll_window">Window size</label>
              <input id="boll_window" type="number" min="5" step="1" />
            </div>
            <div>
              <label for="boll_dev">Std Dev (k)</label>
              <input id="boll_dev" type="number" step="0.1" />
            </div>
            <div class="form-checkbox">
              <input type="checkbox" id="boll_use_testnet" />
              <label for="boll_use_testnet">Use Binance testnet</label>
            </div>
            <div class="form-checkbox">
              <input type="checkbox" id="boll_only_buy" />
              <label for="boll_only_buy">Only buy on dips</label>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Save Bollinger config</button>
        </form>
      </div>
    </div>

    <div class="row">
      <div class="card" data-collapsible>
        <div class="card-header">
          <h2>Bollinger Status</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-body">
          <div id="bollStatus" class="status-section">Loading...</div>
        </div>
      </div>

      <div class="card" data-collapsible>
        <div class="card-header">
          <h2>Manual Single-Coin Sell</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-body">
          <form id="bollManualForm">
            <div class="form-row">
              <div>
                <label for="boll_manual_symbol">Symbol</label>
                <select id="boll_manual_symbol"></select>
              </div>
              <div>
                <label for="boll_manual_qty">Quantity (base)</label>
                <input id="boll_manual_qty" type="number" step="0.0001" />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Sell now</button>
          </form>
          <div class="help-text">
            Sells the selected base asset (e.g. HBAR in HBARUSDC) for its quote
            asset (USDT / USDC / BTC / BNB) using a market order.
            Uses the same environment (testnet / mainnet) as the rest of the bot.
          </div>
        </div>
      </div>
    </div>

    <div class="card" data-collapsible>
      <div class="card-header">
        <h2>Bollinger Chart</h2>
        <span class="toggle-icon">▼</span>
      </div>
      <div class="card-body">
        <div class="help-text">
          Price vs moving average and Bollinger bands. Use a symbol not overlapping with HBAR/DOGE if both bots are running.
        </div>
        <canvas id="bollChart" height="180"></canvas>
        <p id="bollBandInfo"></p>
      </div>
    </div>

    <div class="card" data-collapsible>
      <div class="card-header">
        <h2>Bollinger Trades (latest 100)</h2>
        <span class="toggle-icon">▼</span>
      </div>
      <div class="card-body">
        <table id="bollTradesTable">
          <thead>
            <tr>
              <th>Time</th>
              <th>Symbol</th>
              <th>Side</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Notional</th>
              <th>PnL (<span class="quote-label">USDT</span>)</th>
              <th>Env</th>
            </tr>
          </thead>
          <tbody id="bollTradesBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="nextModalOverlay" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-header-title">Next possible MR trade</div>
        <button class="btn btn-ghost small" id="nextModalClose">✕</button>
      </div>
      <div class="modal-body">
        <div id="nextSignalModalBody" class="status-section">Loading...</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary small" id="nextModalRecalc">Recalculate</button>
        <button class="btn btn-ghost small" id="nextModalCloseFooter">Close</button>
      </div>
    </div>
  </div>
</body>
</html>
